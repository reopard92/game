<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRINITY LOGIC: 05</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts for Luxury Casino Look -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Playfair Display', serif;
            background-color: #050505;
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%);
            color: #e2e8f0;
            overflow-x: hidden;
            user-select: none;
        }

        .font-casino {
            font-family: 'Cinzel', serif;
        }

        /* Gold Gradient Text */
        .text-gold {
            background: linear-gradient(to bottom, #cfc09f 22%, #634f2c 24%, #cfc09f 26%, #cfc09f 27%, #ffecb3 40%, #3a2c0f 78%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            color: #d4af37;
        }
        
        .border-gold {
            border-color: #d4af37;
            box-shadow: 0 0 5px #b8860b;
        }

        .bg-felt {
            background-color: #0f2e18; /* Dark Green Felt */
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23133820' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M0 40L40 0H20L0 20M40 40V20L20 40'/%3E%3C/g%3E%3C/svg%3E");
        }

        .card-shadow {
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), 0 0 0 1px #333 inset;
        }

        .card-anim-enter {
            animation: dealCard 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .reversal-flash {
            animation: flash 0.5s ease-in-out;
        }

        @keyframes dealCard {
            from { transform: translateY(50px) scale(0.8); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        @keyframes flash {
            0% { background-color: transparent; }
            50% { background-color: rgba(212, 175, 55, 0.2); }
            100% { background-color: transparent; }
        }

        .perspective-container {
            perspective: 1200px;
        }
        
        /* Timer Ring Animation */
        .timer-ring circle {
            transition: stroke-dashoffset 1s linear;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons (SVG) ---
        const IconSword = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 17.5L3 6V3h3l11.5 11.5"/><path d="M13 19l6-6"/><path d="M16 16l4 4"/><path d="M19 21l2-2"/></svg>
        );
        const IconWind = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>
        );
        const IconScale = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M16 16l3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="M2 16l3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>
        );
        const IconTrophy = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2z"/></svg>
        );
        const IconSkull = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M16 4.9a5.9 5.9 0 0 0-1.8 0"/><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="M12.5 20v-2.18c0-1.29 1.15-2.22 2.5-1.82 2.94.87 4.54-1.28 4.28-3.57A6.5 6.5 0 0 0 6.58 6.58c-3.14 1.76-4.57 5.25-3.3 8.43.58 1.45 2.38 2.37 3.5 1.82 1.35-.4 2.5.53 2.5 1.82V20"/></svg>
        );
        const IconRefresh = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );
        const IconHome = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        );
        const IconUsers = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        );

        // --- Config ---
        const ALL_CARDS = [1, 2, 3, 4, 5, 6, 7, 8, 9];
        const ROUND_TIME_LIMIT = 15;

        // --- Components ---
        
        // Luxury Card Component
        const Card = ({ number, owner, onClick, disabled, isSelected, isWinner, isLoser, showFace = true }) => {
            // Base Style
            let cardClasses = "relative w-20 h-28 md:w-24 md:h-36 rounded-lg flex items-center justify-center text-4xl font-bold font-casino transition-all duration-300 transform preserve-3d cursor-default ";
            let innerStyle = "absolute inset-0 rounded-lg flex items-center justify-center border-2 shadow-2xl ";

            if (!showFace) {
                // Back of card (Pattern)
                innerStyle += "bg-zinc-900 border-yellow-700 opacity-90";
                return (
                    <div className={`${cardClasses} ${disabled ? '' : 'hover:-translate-y-1'}`} onClick={disabled ? undefined : onClick}>
                        <div className={innerStyle} style={{backgroundImage: 'repeating-linear-gradient(45deg, #111 0, #111 10px, #222 10px, #222 20px)'}}>
                            <div className="w-12 h-12 rounded-full border-2 border-yellow-700/30 flex items-center justify-center">
                                <span className="text-yellow-700/30 font-casino text-xl">TL</span>
                            </div>
                        </div>
                    </div>
                );
            }

            // Face of card
            if (owner === 'player') {
                innerStyle += "bg-zinc-100 text-zinc-900 border-yellow-600 ";
                if (isSelected) cardClasses += " -translate-y-4 ring-4 ring-yellow-400 z-10 ";
                else if (!disabled) cardClasses += " hover:-translate-y-2 cursor-pointer ";
                if (disabled && !isSelected) cardClasses += " opacity-50 grayscale ";
            } else {
                // Opponent Card (Face Up)
                innerStyle += "bg-zinc-900 text-yellow-500 border-yellow-600 ";
                if (disabled) cardClasses += " opacity-70 ";
            }

            if (isWinner) {
                cardClasses += " scale-110 z-20 ";
                innerStyle += " ring-4 ring-yellow-400 bg-yellow-100 text-yellow-900 shadow-[0_0_30px_rgba(234,179,8,0.6)] ";
            }
            if (isLoser) {
                cardClasses += " scale-90 grayscale opacity-40 ";
            }

            return (
                <div className={cardClasses} onClick={disabled ? undefined : onClick}>
                    <div className={innerStyle}>
                        {number}
                        {/* Decorative Corners */}
                        <span className="absolute top-1 left-2 text-xs opacity-50">{number}</span>
                        <span className="absolute bottom-1 right-2 text-xs opacity-50 rotate-180">{number}</span>
                        <div className="absolute top-2 right-2 w-2 h-2 border-t border-r border-current opacity-30"></div>
                        <div className="absolute bottom-2 left-2 w-2 h-2 border-b border-l border-current opacity-30"></div>
                    </div>
                </div>
            );
        };

        // Circular Timer Component
        const CircularTimer = ({ timeLeft, maxTime }) => {
            const radius = 36;
            const stroke = 6;
            const normalizedRadius = radius - stroke * 2;
            const circumference = normalizedRadius * 2 * Math.PI;
            const strokeDashoffset = circumference - (timeLeft / maxTime) * circumference;
            
            const isWarning = timeLeft <= 5;

            return (
                <div className="relative flex items-center justify-center w-24 h-24">
                    <svg height={radius * 2} width={radius * 2} className="rotate-[-90deg]">
                        <circle
                            stroke="rgba(255,255,255,0.1)"
                            strokeWidth={stroke}
                            r={normalizedRadius}
                            cx={radius}
                            cy={radius}
                            fill="transparent"
                        />
                        <circle
                            className="timer-ring"
                            stroke={isWarning ? "#ef4444" : "#d4af37"}
                            strokeWidth={stroke}
                            strokeDasharray={circumference + ' ' + circumference}
                            style={{ strokeDashoffset }}
                            strokeLinecap="round"
                            r={normalizedRadius}
                            cx={radius}
                            cy={radius}
                            fill="rgba(0,0,0,0.5)"
                        />
                    </svg>
                    <div className={`absolute text-3xl font-casino font-bold ${isWarning ? 'text-red-500 timer-warning' : 'text-yellow-500'}`}>
                        {timeLeft}
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            // Constants within App
            const PHASES = {
                1: { name: 'POWER', icon: <IconSword size={20} />, desc: 'High Number Wins', color: 'text-red-500' },
                2: { name: 'SPEED', icon: <IconWind size={20} />, desc: 'Low Number Wins', color: 'text-blue-400' },
                3: { name: 'BALANCE', icon: <IconScale size={20} />, desc: 'Close to 5 Wins', color: 'text-green-500' }
            };

            const [gameState, setGameState] = useState('intro'); // intro, draft, battle, result, intermission
            const [cpuCount, setCpuCount] = useState(1);
            
            // Game Data
            const [availableCards, setAvailableCards] = useState([...ALL_CARDS]);
            const [playerDeck, setPlayerDeck] = useState([]);
            const [cpuDeck, setCpuDeck] = useState([]);
            const [cpu2Deck, setCpu2Deck] = useState([]);
            
            const [currentPhase, setCurrentPhase] = useState(1);
            const [roundInPhase, setRoundInPhase] = useState(1);
            
            const [playerHand, setPlayerHand] = useState([]);
            const [cpuHand, setCpuHand] = useState([]);
            const [cpu2Hand, setCpu2Hand] = useState([]);
            
            const [selectedCard, setSelectedCard] = useState(null);
            const [cpuCard, setCpuCard] = useState(null);
            const [cpu2Card, setCpu2Card] = useState(null);
            
            const [battleResult, setBattleResult] = useState(null);
            const [isReversal, setIsReversal] = useState(false);
            const [score, setScore] = useState({ player: 0, cpu: 0, cpu2: 0 });
            const [battleLog, setBattleLog] = useState([]);
            
            const [isProcessing, setIsProcessing] = useState(false);
            const [timeLeft, setTimeLeft] = useState(ROUND_TIME_LIMIT);
            const timerRef = useRef(null);

            // Helpers
            const cpuDraft = (currAvail) => currAvail[Math.floor(Math.random() * currAvail.length)];
            const cpuPlayCard = (hand) => hand[Math.floor(Math.random() * hand.length)];

            // Timer Logic
            useEffect(() => {
                if (gameState === 'battle' && !selectedCard && !isProcessing) {
                    timerRef.current = setInterval(() => {
                        setTimeLeft((prev) => {
                            if (prev <= 1) {
                                clearInterval(timerRef.current);
                                handleTimeOut();
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [gameState, selectedCard, isProcessing, roundInPhase]);

            const handleTimeOut = () => {
                const randomCard = playerHand[Math.floor(Math.random() * playerHand.length)];
                handleBattle(randomCard);
            };

            const goHome = () => {
                setGameState('intro');
                clearInterval(timerRef.current);
            };

            const startGame = (count) => {
                setCpuCount(count);
                resetGameData();
                setGameState('draft');
            };

            const resetGameData = () => {
                setAvailableCards([...ALL_CARDS]);
                setPlayerDeck([]);
                setCpuDeck([]);
                setCpu2Deck([]);
                setScore({ player: 0, cpu: 0, cpu2: 0 });
                setBattleLog([]);
                setPlayerHand([]);
                setCpuHand([]);
                setCpu2Hand([]);
                setCurrentPhase(1);
                setRoundInPhase(1);
                setIsProcessing(false);
            };

            // Draft Phase
            const handleDraftPick = (number) => {
                if (isProcessing) return;
                const newPlayerDeck = [...playerDeck, number];
                setPlayerDeck(newPlayerDeck);
                let nextAvailable = availableCards.filter(n => n !== number);
                setAvailableCards(nextAvailable);
                setIsProcessing(true);

                if (newPlayerDeck.length === 3) {
                    setTimeout(() => {
                        const cpu1Pick = cpuDraft(nextAvailable);
                        const finalCpuDeck = [...cpuDeck, cpu1Pick];
                        setCpuDeck(finalCpuDeck);
                        nextAvailable = nextAvailable.filter(n => n !== cpu1Pick);
                        
                        let finalCpu2Deck = [];
                        if (cpuCount === 2) {
                             const cpu2Pick = cpuDraft(nextAvailable);
                             finalCpu2Deck = [...cpu2Deck, cpu2Pick];
                             setCpu2Deck(finalCpu2Deck);
                        }
                        setTimeout(() => startBattlePhase(1, newPlayerDeck, finalCpuDeck, finalCpu2Deck), 1000);
                    }, 500);
                    return;
                }
                setTimeout(() => {
                    const cpu1Pick = cpuDraft(nextAvailable);
                    setCpuDeck(prev => [...prev, cpu1Pick]);
                    nextAvailable = nextAvailable.filter(n => n !== cpu1Pick);
                    if (cpuCount === 2) {
                        const cpu2Pick = cpuDraft(nextAvailable);
                        setCpu2Deck(prev => [...prev, cpu2Pick]);
                        nextAvailable = nextAvailable.filter(n => n !== cpu2Pick);
                    }
                    setAvailableCards(nextAvailable);
                    setIsProcessing(false);
                }, 600);
            };

            const startBattlePhase = (phaseNum, pDeck, cDeck, c2Deck) => {
                setCurrentPhase(phaseNum);
                setRoundInPhase(1);
                setPlayerHand([...pDeck]);
                setCpuHand([...cDeck]);
                setCpu2Hand(c2Deck && c2Deck.length ? [...c2Deck] : []);
                resetRoundState();
                setGameState('battle');
            };

            const resetRoundState = () => {
                setSelectedCard(null);
                setCpuCard(null);
                setCpu2Card(null);
                setBattleResult(null);
                setIsReversal(false);
                setIsProcessing(false);
                setTimeLeft(ROUND_TIME_LIMIT);
            };

            const handleBattle = (pCard) => {
                if (isProcessing) return;
                setSelectedCard(pCard);
                setIsProcessing(true);
                
                const cCard = cpuPlayCard(cpuHand);
                let c2Card = null;
                if (cpuCount === 2) c2Card = cpuPlayCard(cpu2Hand);
                
                // Card Reveal Animation Sequence
                setTimeout(() => {
                    setCpuCard(cCard); // CPU 1 Reveal
                    
                    if (cpuCount === 2) {
                        setTimeout(() => {
                            setCpu2Card(c2Card); // CPU 2 Reveal
                            setTimeout(() => resolveBattle(pCard, cCard, c2Card), 1000);
                        }, 1000);
                    } else {
                        setTimeout(() => resolveBattle(pCard, cCard, null), 1000);
                    }
                }, 1000);
            };

            const resolveBattle = (pVal, cVal, c2Val) => {
                const sum = pVal + cVal + (c2Val || 0);
                const reversal = sum === 10;
                setIsReversal(reversal);

                let participants = [{ owner: 'player', val: pVal }, { owner: 'cpu', val: cVal }];
                if (c2Val) participants.push({ owner: 'cpu2', val: c2Val });

                const determineWinners = () => {
                    let sorted = [...participants];
                    if (currentPhase === 1) { // Power
                        sorted.sort((a, b) => b.val - a.val); 
                        const max = sorted[0].val; 
                        return participants.filter(p => p.val === max).map(p => p.owner); 
                    }
                    else if (currentPhase === 2) { // Speed
                        sorted.sort((a, b) => a.val - b.val); 
                        const min = sorted[0].val; 
                        return participants.filter(p => p.val === min).map(p => p.owner); 
                    }
                    else { // Balance
                        sorted.sort((a, b) => Math.abs(a.val - 5) - Math.abs(b.val - 5)); 
                        const closest = Math.abs(sorted[0].val - 5); 
                        return participants.filter(p => Math.abs(p.val - 5) === closest).map(p => p.owner); 
                    }
                };

                let winners = determineWinners();
                if (reversal) {
                    const all = participants.map(p => p.owner);
                    const losers = all.filter(o => !winners.includes(o));
                    winners = losers.length ? losers : all;
                }

                setScore(prev => {
                    const ns = { ...prev };
                    winners.forEach(w => ns[w] += 1);
                    return ns;
                });
                setBattleResult(winners);
                setBattleLog(prev => [{ phase: currentPhase, round: roundInPhase, pVal, cVal, c2Val, winners, reversal }, ...prev]);

                setTimeout(() => nextRound(pVal, cVal, c2Val), 3000);
            };

            const nextRound = (pVal, cVal, c2Val) => {
                setPlayerHand(prev => prev.filter(c => c !== pVal));
                setCpuHand(prev => prev.filter(c => c !== cVal));
                setCpu2Hand(prev => prev.filter(c => c !== c2Val));

                if (roundInPhase < 3) {
                    setRoundInPhase(r => r + 1);
                    resetRoundState();
                } else {
                    if (currentPhase < 3) {
                        setGameState('intermission');
                        setTimeout(() => startBattlePhase(currentPhase + 1, playerDeck, cpuDeck, cpu2Deck), 4000);
                    } else {
                        setGameState('result');
                    }
                }
            };

            // --- Render Screens ---

            // Common: Home Button
            const HomeButton = () => (
                <button onClick={goHome} className="fixed top-4 left-4 z-50 text-yellow-600 hover:text-yellow-400 transition-colors">
                    <IconHome size={28} />
                </button>
            );

            // Intro
            if (gameState === 'intro') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-4 text-center">
                        <div className="mb-4">
                            <IconSword size={48} className="inline text-yellow-600 mx-2" />
                            <IconScale size={48} className="inline text-yellow-600 mx-2" />
                            <IconWind size={48} className="inline text-yellow-600 mx-2" />
                        </div>
                        <h1 className="text-5xl md:text-8xl font-casino font-black mb-2 text-gold tracking-widest drop-shadow-lg">
                            TRINITY
                        </h1>
                        <h2 className="text-2xl md:text-4xl font-casino text-yellow-700/80 tracking-[0.5em] mb-12">
                            LOGIC
                        </h2>
                        
                        <div className="flex flex-col gap-6 w-full max-w-xs">
                            <button onClick={() => startGame(1)} className="group relative px-8 py-4 bg-zinc-900 border border-yellow-700 hover:bg-yellow-900/20 text-yellow-500 font-casino tracking-widest transition-all overflow-hidden">
                                <div className="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-yellow-500/10 to-transparent -translate-x-full group-hover:animate-[shimmer_1s_infinite]"></div>
                                <span className="flex items-center justify-center gap-3">
                                    <IconUsers size={20} /> VS DEALER
                                </span>
                            </button>
                            <button onClick={() => startGame(2)} className="group relative px-8 py-4 bg-zinc-900 border border-yellow-700 hover:bg-yellow-900/20 text-yellow-500 font-casino tracking-widest transition-all">
                                <span className="flex items-center justify-center gap-3">
                                    <IconUsers size={20} /><IconUsers size={20} className="-ml-3" /> TRI-BATTLE
                                </span>
                            </button>
                        </div>
                        <div className="mt-12 text-zinc-600 text-xs font-casino tracking-widest">
                            CASINO ROYALE EDITION
                        </div>
                    </div>
                );
            }

            // Draft
            if (gameState === 'draft') {
                return (
                    <div className="min-h-screen p-4 flex flex-col items-center bg-felt relative">
                        <HomeButton />
                        
                        <div className="w-full max-w-5xl mt-12 mb-8 flex justify-between items-start">
                            {/* Player Status */}
                            <div className="text-left">
                                <div className="text-xs text-yellow-600 font-casino mb-2 tracking-widest">YOUR HAND</div>
                                <div className="flex gap-2 h-24">
                                    {playerDeck.map((n, i) => (
                                        <div key={i} className="w-16 h-24 bg-zinc-100 border-2 border-yellow-600 rounded flex items-center justify-center text-2xl font-casino font-bold text-black shadow-lg">
                                            {n}
                                        </div>
                                    ))}
                                    {[...Array(3 - playerDeck.length)].map((_, i) => (
                                        <div key={`e-${i}`} className="w-16 h-24 border-2 border-dashed border-yellow-800/30 rounded"></div>
                                    ))}
                                </div>
                            </div>

                            <div className="text-center pt-2">
                                <h2 className="text-3xl font-casino text-gold drop-shadow-md">DRAFT</h2>
                                <p className="text-yellow-700/70 text-sm mt-1 tracking-widest animate-pulse">
                                    {isProcessing ? 'DEALER IS CHOOSING...' : 'CHOOSE YOUR CARD'}
                                </p>
                            </div>

                            {/* CPU Status */}
                            <div className="text-right">
                                <div className="text-xs text-yellow-600 font-casino mb-2 tracking-widest">DEALER HAND</div>
                                <div className="flex gap-2 justify-end h-24">
                                    {cpuDeck.map((n, i) => (
                                        <div key={i} className="w-16 h-24 bg-zinc-900 border border-yellow-700 rounded flex items-center justify-center text-xl font-casino text-yellow-500 shadow-lg">
                                            {n}
                                        </div>
                                    ))}
                                    {[...Array(3 - cpuDeck.length)].map((_, i) => (
                                        <div key={`ce-${i}`} className="w-16 h-24 border-2 border-dashed border-yellow-800/30 rounded"></div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-3 gap-6 mt-4">
                            {ALL_CARDS.map(number => {
                                const isAvailable = availableCards.includes(number);
                                const isPlayerPick = playerDeck.includes(number);
                                const isCpuPick = cpuDeck.includes(number) || cpu2Deck.includes(number);
                                
                                return (
                                    <div key={number} className="relative">
                                        <Card 
                                            number={number} 
                                            owner={isPlayerPick ? 'player' : 'cpu'} // Visual style only
                                            showFace={true}
                                            onClick={() => handleDraftPick(number)}
                                            disabled={!isAvailable || isProcessing}
                                            isSelected={isPlayerPick}
                                            isLoser={!isAvailable && !isPlayerPick && !isCpuPick} // Fade out unavailable
                                        />
                                        {isCpuPick && <div className="absolute inset-0 flex items-center justify-center bg-black/60 rounded-lg text-yellow-500 font-casino text-xs tracking-widest border border-yellow-500/50">TAKEN</div>}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            }

            // Intermission
            if (gameState === 'intermission') {
                const nextPhase = PHASES[currentPhase + 1] || PHASES[1];
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-black intermission-enter text-center p-8">
                        <div className="border-y-2 border-yellow-800/50 py-12 w-full max-w-2xl bg-zinc-900/50 backdrop-blur-sm">
                            <h2 className="text-sm text-yellow-600 font-casino tracking-[0.5em] mb-6">NEXT STAGE</h2>
                            <div className={`text-6xl font-casino font-bold ${nextPhase.color} flex flex-col items-center gap-6 mb-4 drop-shadow-lg`}>
                                {nextPhase.icon}
                                <span className="text-gold">{nextPhase.name}</span>
                            </div>
                            <div className="w-16 h-1 bg-yellow-700 mx-auto mb-6"></div>
                            <p className="text-xl text-zinc-400 font-serif italic">{nextPhase.desc}</p>
                        </div>
                    </div>
                );
            }

            // Battle
            if (gameState === 'battle') {
                const phaseConfig = PHASES[currentPhase];
                
                return (
                    <div className={`min-h-screen flex flex-col bg-felt transition-colors duration-1000 ${isReversal ? 'saturate-150 brightness-110' : ''}`}>
                        <HomeButton />
                        
                        {/* Header Area */}
                        <div className="absolute top-0 left-0 right-0 p-4 flex justify-between items-start z-10 bg-gradient-to-b from-black/80 to-transparent h-32 pointer-events-none">
                            <div className="text-center pl-12">
                                <div className="text-[10px] text-yellow-600 font-casino tracking-widest">YOU</div>
                                <div className="text-4xl font-casino text-white drop-shadow-md">{score.player}</div>
                            </div>
                            
                            <div className="text-center">
                                <div className={`flex flex-col items-center ${phaseConfig.color} drop-shadow-lg`}>
                                    <div className="flex items-center gap-2 mb-1">
                                        {phaseConfig.icon}
                                        <span className="font-casino text-2xl font-bold tracking-widest text-gold">{phaseConfig.name}</span>
                                    </div>
                                    <div className="text-xs text-zinc-300 font-serif italic opacity-80">{phaseConfig.desc}</div>
                                </div>
                            </div>

                            <div className="text-center">
                                <div className="text-[10px] text-yellow-600 font-casino tracking-widest">DEALER</div>
                                <div className="text-4xl font-casino text-white drop-shadow-md">{score.cpu}</div>
                            </div>
                        </div>

                        {/* Game Field */}
                        <div className="flex-1 flex flex-col items-center justify-center relative overflow-hidden w-full max-w-6xl mx-auto">
                            
                            {/* Center Timer - Absolute Center */}
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-0 opacity-80">
                                <CircularTimer timeLeft={timeLeft} maxTime={ROUND_TIME_LIMIT} />
                            </div>

                            {/* Reversal Effect */}
                            {isReversal && (
                                <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-50 reversal-flash">
                                    <div className="text-yellow-400 font-casino text-6xl md:text-9xl font-bold tracking-widest border-y-4 border-yellow-400 bg-black/50 w-full text-center py-4 transform -rotate-6 backdrop-blur-sm">
                                        REVERSAL
                                    </div>
                                </div>
                            )}

                            {/* Opponent Area (Top) */}
                            <div className="w-full flex justify-around mb-12 z-10">
                                {/* CPU 1 */}
                                <div className="flex flex-col items-center gap-4">
                                    {/* Open Hand Display */}
                                    <div className="flex gap-1 p-2 bg-black/40 rounded-lg border border-yellow-900/30">
                                        <span className="text-[10px] text-yellow-700 font-casino mr-1 writing-vertical">HAND</span>
                                        {cpuHand.map((n, i) => (
                                            <div key={i} className="w-6 h-8 bg-zinc-800 text-yellow-600 flex items-center justify-center text-xs font-bold border border-yellow-900 rounded">
                                                {n}
                                            </div>
                                        ))}
                                    </div>
                                    
                                    {/* Play Slot */}
                                    <div className="relative h-36 w-24 flex items-center justify-center">
                                        {cpuCard ? (
                                            <div className="card-anim-enter">
                                                <Card number={cpuCard} owner="cpu" isWinner={battleResult && battleResult.includes('cpu')} isLoser={battleResult && !battleResult.includes('cpu')} />
                                                {battleResult && battleResult.includes('cpu') && <div className="absolute -top-8 text-yellow-400 font-casino font-bold text-sm tracking-widest animate-bounce">WIN</div>}
                                            </div>
                                        ) : (
                                            <div className="w-20 h-28 border-2 border-dashed border-yellow-800/30 rounded-lg flex items-center justify-center">
                                                <span className="text-yellow-900/50 font-casino text-xs">DEALER</span>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* CPU 2 */}
                                {cpuCount === 2 && (
                                    <div className="flex flex-col items-center gap-4">
                                        <div className="flex gap-1 p-2 bg-black/40 rounded-lg border border-yellow-900/30">
                                            <span className="text-[10px] text-orange-700 font-casino mr-1 writing-vertical">HAND</span>
                                            {cpu2Hand.map((n, i) => (
                                                <div key={i} className="w-6 h-8 bg-zinc-800 text-orange-600 flex items-center justify-center text-xs font-bold border border-orange-900 rounded">
                                                    {n}
                                                </div>
                                            ))}
                                        </div>
                                        <div className="relative h-36 w-24 flex items-center justify-center">
                                            {cpu2Card ? (
                                                <div className="card-anim-enter">
                                                    <Card number={cpu2Card} owner="cpu2" isWinner={battleResult && battleResult.includes('cpu2')} isLoser={battleResult && !battleResult.includes('cpu2')} />
                                                </div>
                                            ) : <div className="w-20 h-28 border-2 border-dashed border-orange-800/30 rounded-lg flex items-center justify-center"><span className="text-orange-900/50 font-casino text-xs">RIVAL</span></div>}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Result Text Area */}
                            <div className="h-8 mb-4 z-20">
                                {battleResult && (
                                    <div className="font-casino text-3xl font-bold animate-bounce text-center drop-shadow-lg tracking-widest">
                                        {battleResult.includes('player') ? <span className="text-emerald-400">YOU WIN</span> : ''}
                                        {battleResult.length > 0 && !battleResult.includes('player') ? <span className="text-red-500">YOU LOSE</span> : ''}
                                        {battleResult.length === 0 && <span className="text-zinc-400">DRAW</span>}
                                    </div>
                                )}
                            </div>

                            {/* Player Area (Bottom) */}
                            <div className="flex flex-col items-center mt-auto z-10 w-full">
                                {/* Play Slot */}
                                <div className="relative h-36 w-24 mb-6 flex items-center justify-center">
                                    {selectedCard ? (
                                        <div className="card-anim-enter">
                                            <Card number={selectedCard} owner="player" isWinner={battleResult && battleResult.includes('player')} isLoser={battleResult && !battleResult.includes('player')} />
                                            {battleResult && battleResult.includes('player') && <div className="absolute -top-8 left-0 right-0 text-center text-emerald-400 font-casino font-bold text-sm tracking-widest animate-bounce">WIN</div>}
                                        </div>
                                    ) : (
                                        <div className="w-20 h-28 border-2 border-dashed border-yellow-500/20 rounded-lg flex items-center justify-center animate-pulse">
                                            <span className="text-yellow-500/50 font-casino text-xs">PLACE</span>
                                        </div>
                                    )}
                                </div>

                                {/* Hand UI */}
                                <div className="w-full bg-gradient-to-t from-black via-black/90 to-transparent pt-8 pb-4 px-4 flex justify-center">
                                    <div className="flex gap-4 md:gap-8 items-end h-32">
                                        {playerHand.map((num, i) => (
                                            <Card 
                                                key={`${currentPhase}-${roundInPhase}-${i}`} 
                                                number={num} 
                                                owner="player" 
                                                onClick={() => !selectedCard && handleBattle(num)} 
                                                disabled={!!selectedCard} 
                                            />
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Result Screen
            if (gameState === 'result') {
                const scores = [
                    { name: 'YOU', val: score.player, isPlayer: true },
                    { name: 'DEALER', val: score.cpu, isPlayer: false }
                ];
                if (cpuCount === 2) scores.push({ name: 'RIVAL', val: score.cpu2, isPlayer: false });
                scores.sort((a, b) => b.val - a.val);
                const isWinner = scores[0].isPlayer;
                const isDraw = scores[0].val === score.player && !scores[0].isPlayer;

                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-4 text-center bg-black relative overflow-hidden">
                        {/* Background Effect */}
                        {isWinner && !isDraw && <div className="absolute inset-0 bg-gradient-to-b from-yellow-900/20 to-black animate-pulse"></div>}
                        
                        <div className="mb-8 scale-150 relative z-10">
                            {isWinner && !isDraw ? <IconTrophy size={80} className="text-yellow-400 drop-shadow-[0_0_15px_rgba(250,204,21,0.5)]" /> : 
                             isDraw ? <IconRefresh size={80} className="text-zinc-500" /> :
                             <IconSkull size={80} className="text-red-900" />}
                        </div>
                        
                        <h2 className="text-5xl md:text-7xl font-casino font-bold mb-12 relative z-10 tracking-widest">
                            {isWinner && !isDraw ? <span className="text-gold">VICTORY</span> : 
                             isDraw ? <span className="text-zinc-400">DRAW</span> : 
                             <span className="text-red-800">DEFEAT</span>}
                        </h2>

                        <div className="flex flex-col gap-4 mb-12 w-full max-w-md relative z-10">
                            {scores.map((s, i) => (
                                <div key={i} className={`flex justify-between items-center p-6 rounded border ${s.isPlayer ? 'bg-zinc-800 border-yellow-600' : 'bg-zinc-900 border-zinc-800'}`}>
                                    <div className="flex items-center gap-4">
                                        <span className="text-2xl font-casino text-zinc-500">#{i + 1}</span>
                                        <span className={`text-xl font-bold font-casino tracking-widest ${s.isPlayer ? 'text-yellow-400' : 'text-zinc-400'}`}>{s.name}</span>
                                    </div>
                                    <span className="text-4xl font-casino font-bold text-white">{s.val}</span>
                                </div>
                            ))}
                        </div>

                        <button onClick={goHome} className="relative z-10 px-10 py-4 bg-zinc-800 hover:bg-zinc-700 text-white rounded font-casino tracking-widest border border-zinc-600 transition-colors flex items-center gap-3">
                            <IconRefresh size={20} /> PLAY AGAIN
                        </button>
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
